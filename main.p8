pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- roots need control
-- global game jam 2023 daejeon, south korea
-- theme : roots
-- who make this : !cyberapex (yechan choi)
-- skagogames 2023. made in skago.

#include player.p8
#include root.p8
#include connect.p8
#include city.p8
#include rainpower.p8
#include raindowner.p8
#include uiux.p8
#include introscene.p8
#include camerashake.p8
#include starforward.p8
#include rocket.p8

local player = playercontroller.new()
local root = rootobject.new()
local connect = collisionliner.new()
local city = cities.new()

_score = 0
_life = 3

readycount = 20
deltatime = 0

gamestates = nil

all_score = {}

rocket_set =
{
    direction = {"left","right"}
}

function _init()
    gamestates = "intro"
    rain_downer_x = player.x + (rnd(1*8) + (-1*8))

    addrainpower()
    addraindowner_x(rain_downer_x)

    for i=1,5 do
        add_rocket(rocket_set.direction[flr(rnd(2))+1])
    end

    sf.generate()
end

function _update60()
    if gamestates == "mainmenu" then
        
        if btnp(â) then
            
            gamestates = "ready"
        end
    elseif gamestates == "ingame" then
        
        player.update()
        root.update(player)
        connect.update()

        rain_downer_x = player.x + (rnd(1*8) + (-1*8))

        update_all_rainpower()
        update_all_raindowner()

        rocket_all_update()

        if btnp(â) then
            if connect.targetcoll(player,0) then
                root.killroot(player)
                root.speed+=0.05
                _score += 1
                sfx(0)
            end

            for rck in all(rocket) do
                if connect.targetcoll(rck,8) then
                    sfx(5)
                    set_offset(1.5)
                    del(rocket,rck)
                    _score += 10
                end
            end
        end

        if btn(ğŸ…¾ï¸) and btn(â¬…ï¸) then
            if connect.targetcoll_not_addspeed(player) and player.x > 0 then
                player.isright = false
                player.x-=5
            end
        elseif btn(ğŸ…¾ï¸) and btn(â¡ï¸) then
            if connect.targetcoll_not_addspeed(player) and player.x < 127 then
                player.isright = true
                player.x+=5
            end
        end

        if not player.isdead then
            for rp in all(rain_power) do
                if player.oncollisionother(rp,root, rain_power) then
                    sfx(4)
                    _score += 5
                end
            end 

            for rd in all(rain_downer) do
                if player.oncollisionother(rd,root, rain_downer) then
                    set_offset(0.5)
                    sfx(2)
                end
            end 

            for c_rocket in all(rocket) do

                if root.hit_rocket(player, c_rocket) then
                    sfx(3)
                    player.isdead = true 
                end
            end


            if count(rain_power) == 0 then
                addrainpower()
            end

            if count(rain_downer) == 0 then
                addraindowner_x(rain_downer_x)
            end 

            if count(rocket) == 0 then
                add_rocket(rocket_set.direction[flr(rnd(2))+1])
            end
        end

        if player.isdead and _life == 0 then
            sfx(7)
            set_offset(2)
            gamestates = "gameover"
        elseif player.isdead and _life > 0 then

            add(all_score,_score)
            
            dangerlevel = 1
            _life-=1
            
            set_offset(0.5)

            gamestates="ready"

            player.returnback()
            root.returnback()
            connect.returnback()

            delete_all_rainpower()
            delete_all_raindowner()

            delete_all_rocket()

            _score = 0

        end

    elseif gamestates == "gameover" then

        if btnp(â) then
            extcmd('reset')
        end
    elseif gamestates == "intro" then
        update_intro()

        if iswaitended() then
            gamestates="mainmenu"
        end
    elseif gamestates == "ready" then
        deltatime=1/stat(8)
        readycount-=deltatime*8

        if readycount < 0 then
            gamestates = "ingame"
            readycount = 20
        end
    end
end

function _draw()
    cls()

    if gamestates == "mainmenu" then
        shakescreen()

        spr(84,37,40,2,2)

        print("roots",55, 40,7)
        print("need",55, 46,7)
        print("control.",55, 52,7)

        print("press â to start!",27, 75,7)
        
        print("global game jam 2023", 23,103,3)
        print("skagogames. made in skago.",13,110,3)
        print("rnc_02",100,2,1)

    elseif gamestates == "ingame" then

        sf.update()

        player.draw()
        city.draw()
        root.draw(player)
        connect.draw()

        shakescreen()
        
        draw_all_rainpower()
        draw_all_raindowner()

        rocket_all_draw()

        draw_ui_score(connect, _score)
        draw_ui_roots(root.ridx, player)

    elseif gamestates == "gameover" then

        shakescreen()

        spr(128,45,30,5,4)
        
        print("game ended!",45,63,7)

        local all_score_result = all_score[1] + all_score[2] + all_score[3]
        print("scores:"..all_score_result,45,70,7)

        print("thank you for playing!!",23,88,rnd(8))
        print("press â to restart!",27, 95,7)

        print("global game jam 2023", 25,109,3)
        print("skagogames. made in skago.",15,115,3)
    elseif gamestates == "intro" then
        draw_intro()
    elseif gamestates == "ready" then
        shakescreen()

        print("get ready! controller!",20, 30, rnd(16))
        print("player life : ".._life,34,42,8)

        print("ğŸ…¾ï¸+â¬…ï¸â¡ï¸: moveright rootman",12,60,10)
        print("â: downgrade root",12,67,10)

        print("daejeon is u :)", 34, 90, 11)
    end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003333000000000000000000000000000000000000000000000000004440000000004000000000000000000400000000000000000000000000000000
00000000033333300000000000000000000000000000000000000000000000000040000004444000000000000000000440000000000440000000000000000000
0000000003a33a300000000000000000000000000000000000000000000000000044000004000000000000000000000044000000000400000000000000000000
0000000003a33a300000000000000000000000000000000000000000000000000004000044000000000000000000000004000000000400000044400000000000
00000000033333300000000000000000000000000000000000000000000000000004400440000000000000000000000004400000004444000040044000000000
00000000333333330000000000000000000000000000000000000000000000000000444000000000000000000000000000440000004004444440000000000000
00000000999999990000000000000000000000000000000000000000000000000000044000000000000000000000000000040000440000000000000000000000
00000000000000000000000000000000000000000040000000000000000000000000004400000000000000040000000000040044000000000000000000000000
00000000000000000000000000000000004000000044000000000000040000000400044000000004000004440044400000044040000000000000000000000000
00000000000000000000000000000000004400000004000000000000044000000444040044000004004444000000440000044440000000000004000000000000
00000000000000000000000000000000000440000004444400000000004440000004440040000004444000000000044444444400000000000044000000000000
00000000000000000000000000000000000040000000044000040044000040000000040040000044400000000000000000004400000000000440000000000000
00000000000000000000000000000000000044000000440000040440000040000000040440040440400000000000000000000400000000004440000000000000
00000000000000000000000000000000000044444000444000044400000044000000044400044400440000000000000000000400000000044044000440000000
00000000000000000000000000000000000440004004404400004000000004440000044000004404404400000000000000444440444444440000444444000000
00000000000000040040000000040000004400004444000000044000000000044444440000000444000444000000000044400444444400444000000000000000
00000000000000440044000000440000004440000444000000040000000044440004400000004440000004400000000440000000400000004000000000000000
00000000000004400004400044400000444040000044000000440040000040000004000000444400000000400000000000000004400000004400000000000000
00000000004444000004444444000000400004000004444000404440000040000004000000400000000000000000000000000004400000000400000000000000
00000000000440000004400004400000000004000000404440444000000440000004400000400000000000000000004000000000400000000400000000000000
00000000000400000044444000400000000004000000400044440000044400000000400004400000000000000000004400440044400000000444400000000000
00000000000400444440044000400000000004400000400000040000000000000000044444000000000000000000000444444440000000000000000000000000
00000000000044400400004000400000000000000004400000040000000000000000044044400000000000000000000000004400000000000000000000000000
04000000000044000400000000400000000000004044004000040000000000000044440000444000000000000000000000000444000000000000000000000000
04400000000040000400000000440000000000004440044000040000000000000440044000004400000000000000000000000444000000000000000000000000
00400044000040000444440000044000000000000440440000044400000000000000004400000444000000000000000000000444444444000000000000000000
00444040000040000040044000004000000000000044400000000440000000000000000400000000000000000444400000000040000004400040000000000000
00004440004440000040000000000000000000000040000000000000000000000000000400000000000000000044400000000040000000444440000000000000
00004400000000000004000000000000000000000044400000000000000000000000000400000000000000000004000000000040000000000000000000000000
00004000000000000004000000000000000000000004400000000000000000000000000440000000000000000004000000004440000000000000000000000000
44444444000000004444444400000000000000004444444400000000000000004444444440000000000000000004400044444444000000000000000000000000
00003300000022000000000000000000000cc00000088000000bb000000000004440000040000000000000000000440004000000000000004000000000000000
00bb330000882200000000000000000000cccc000088880000bbbb00000000000444400040000044000000000000044444000000000000004000044000000000
00bb33b00088228000000000000000000cccccc0088888800bbbbbb0000000000000444440000400000000000000000004000000000000004000040000000000
03bb3bb00288288000000000000000000cccccc0088888800bbbbbb0000000000000004444444400000000000000000004000004440000044444440000000000
0bbb3bb0088828800000000000000000cccccccc88888888bbbbbbbb000000000000004440440000000000000000000444400044000000044004000000000000
3bbbbbb3288888820000000000000000ccccccdc888888e8bbbbbb3b000000000000004000000000000000000000004404444440000000400000400000000000
bbbbbbbb888888880000000000000000cccccddc88888ee8bbbbb33b000000000000044000000000000000000000004004000000000004400000400004440000
333333332222222200000000000000000cccccc0088888800bbbbbb0000000000000044000000000000000000044444004000000000044000000440044040000
00000000000000000000000000000000000000000040404400000000000000000000044400000004000000000044000044000000000400000000044400000000
00000000000000000000000000000000000044400044404400000000000000000000004400000044000000000000000040000000000440000044000000000000
00000000000000000000000000000000004444444440004400000000000000000000004444444440000000000000000040000000000444400040000000000000
00000000000000000000000000000000000000004444004400000000000000000000444440000000000000000000000440000000000400400040000000000000
00000000000000000000000000000000000000000444004400000000000000000004000044000000000000000000000400000000044000400040000000000000
00000000000000000000000000000000000000000044444400000000000000000044000044000000000000000000000444400000400000440440000000000000
00000000000000000000000000000000000000000444444400000000000000000040000044000000000000000000000000440004000000044400000000000000
00000000000000000000000000000000000000004440444400000000000000000000044444444000000000000000000000040004000000004444400000000000
00000000000000000000000000000000000044444040044400000000000000000000000000000000000000000000000000004040000000004000400000000000
006666500566660000000000000000000000444400400044000000000000000000007770cccccc0a000000000000444000004040000000004400000000000000
066766655666766000000000000000000004400000400044000000000000000000077770cccccc0a000000000000004400004400000000004400000000000000
667766655666776600000000000000000000000040000444000000000000000000777770cccccc0a000000000000000400004000000000044000000000000000
666666655666666600000000000000000000004444444444000000000000000007777770cccccc0a000000000000000444404400000000040000000000000000
066666655666666000000000000000000000444000440044000000000000000077777770cccccc0a000000000000000000440400000000440000000000000000
006666500566660000000000000000000004400000400044000000000000000077777770cccccc0a000000000000000000044400000000400000000000000000
0000000000000000000000000000000000000000000000440000000000000000777777700000000a000000000000000000000400000000400000000000000000
0000000000000000000000000000000000000000000000000000000000000000777777777777770a000000000000000000000440000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000777777777777770a000000000000000000000044000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000777777777777770a000000000000000000000004000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000077777777777700a000000000000000000000004404400040000000000000000
0000000000000000000000000000000000000000000000000000000000000000007777777777000a000000000000000000000004440444440000000000000000
0000000000000000000000000000000000000000000000000000000000000000000777777770000a000000000000000000000004000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000077777700000a000000000000000000000044000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044444444000000000000000000000
00022200000000020000000002220000002000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022220000000022200002222000000002202200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00002220000220002200022200000000000202200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000222200220000222882000000000000222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000222202222000022820000000000002222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000022202222000028222000000000002222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000002222220000222222000000000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000222222200000200022000000000222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222222200002200022000000002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222220022220000000022000202222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022222200000022002222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000222220000022222222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000222222000222222200222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002222222002222200000022220002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022200222222222200000022222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222200022222222200000022222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000022222000002222220000000000288822000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222282000000000222220000000002222822200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222820000000000222222000000022220222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000220000000000022222000000222220002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00002220000000000022222000000000020000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022200000000000222222200000000022000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022000000000002222222200000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033a33a3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000033aa33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000033aa33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000003a33a3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000033003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00050000000000000000000277502a70028700267002f750287502070020700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000000000000001e6503305028650246502165000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000263500000000000323500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000366503565027650356502b6502b65012650186501c65029650286500d5500c55009550075500755006550055500155000550005500055000550005500055000550005500055000550005500055000550
001000000000000000307503975000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000266502e650366503a6502f65027650246501f6501d6501c650106501165014650166501b6500665006650076500a65000650006500000000650000000000000000000000000000000000000000000000
001000003f4503e4503e4503e4503e4503f4503f4503f4503f4503f4503f4503e4503e4503e45039750337502f7502c750287502575023750207501d7501b7501875015750127500f7500c7500a7500775004750
001000001a3501f350283502235010350033500135005350093500b350103501535002350043502c35028350233501d35018350113500c3500835005350023500035000000000000000000000000000000000000
